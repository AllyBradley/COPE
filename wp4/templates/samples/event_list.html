{% extends "base_site.html" %}
{% load l10n i18n %}

{% block page_title %}Samples{% endblock %}
{% block page_header %}Samples - Home{% endblock %}
{% block page_trail %}
    <li><a href="{% url 'home' %}">Home</a></li>
    <li><a href="{% url 'wp4:index' %}">WP4: Compare</a></li>
    <li class="active">Samples</li>
{% endblock %}

{% block content %}
    {% if event_list %}
        {% include 'includes/paginator.html' %}
        <table class="table table-responsive table-condensed">
            <thead>
            <tr>
                <th>
                    ID
                    {% if request.GET.order_by == "id" and request.GET.ordering == "asc" %}
                        <a href="?order_by=id&ordering=desc&page={{ request.GET.page }}&q={{ request.GET.q }}"><i
                                class="text-success glyphicon glyphicon glyphicon-sort-by-attributes"></i></a>
                    {% elif request.GET.order_by == "id" and request.GET.ordering == "desc" %}
                        <a href="?page={{ request.GET.page }}&q={{ request.GET.q }}"><i
                                class="text-success glyphicon glyphicon glyphicon-sort-by-attributes-alt"></i></a>
                    {% else %}
                        <a href="?order_by=id&ordering=asc&page={{ request.GET.page }}&q={{ request.GET.q }}"><i
                                class="glyphicon glyphicon glyphicon-sort"></i></a>
                    {% endif %}
                </th>
                <th>Type
                    {% if request.GET.order_by == "type" and request.GET.ordering == "asc" %}
                        <a href="?order_by=type&ordering=desc&page={{ request.GET.page }}&q={{ request.GET.q }}"><i
                                class="text-success glyphicon glyphicon glyphicon-sort-by-attributes"></i></a>
                    {% elif request.GET.order_by == "type" and request.GET.ordering == "desc" %}
                        <a href="?page={{ request.GET.page }}&q={{ request.GET.q }}"><i
                                class="text-success glyphicon glyphicon glyphicon-sort-by-attributes-alt"></i></a>
                    {% else %}
                        <a href="?order_by=type&ordering=asc&page={{ request.GET.page }}&q={{ request.GET.q }}"><i
                                class="glyphicon glyphicon glyphicon-sort"></i></a>
                    {% endif %}
                </th>
                <th>Name
                    {% if request.GET.order_by == "name" and request.GET.ordering == "asc" %}
                        <a href="?order_by=name&ordering=desc&page={{ request.GET.page }}&q={{ request.GET.q }}"><i
                                class="text-success glyphicon glyphicon glyphicon-sort-by-attributes"></i></a>
                    {% elif request.GET.order_by == "name" and request.GET.ordering == "desc" %}
                        <a href="?page={{ request.GET.page }}&q={{ request.GET.q }}"><i
                                class="text-success glyphicon glyphicon glyphicon-sort-by-attributes-alt"></i></a>
                    {% else %}
                        <a href="?order_by=name&ordering=asc&page={{ request.GET.page }}&q={{ request.GET.q }}"><i
                                class="glyphicon glyphicon glyphicon-sort"></i></a>
                    {% endif %}
                </th>
                <th>Taken at</th>

                <th>Barcode</th>
                <th>Collected</th>
                <th>Trial ID</th>
            </tr>
            </thead>
            <tbody>
            {% for event in event_list %}
                <tr>
                    <td>
                        {% if perms.samples.change_event %}
                            <a href="{% url 'wp4:samples:event_detail' pk=event.pk %}" class="btn btn-default btn-xs"><i
                                    title="edit" class="glyphicon glyphicon-eye-open"></i></a>
                            <a href="{% url 'wp4:samples:event_update' pk=event.pk %}" class="btn btn-primary btn-xs"><i
                                    title="edit" class="glyphicon glyphicon-edit"></i> {{ event.id }}</a>
                        {% elif perms.samples.view_event %}
                            <a href="{% url 'wp4:samples:event_detail' pk=event.pk %}" class="btn btn-default btn-xs"><i
                                    title="edit" class="glyphicon glyphicon-eye-open"></i> {{ event.id }}</a>
                        {% else %}
                            {{ event.id }}
                        {% endif %}
                    </td>
                    <td>{{ event.get_type_display }}</td>
                    <td>{{ event.get_name_display }}</td>
                    <td>{{ event.taken_at }}</td>

                    {% if event.type == 1 %}{# Blood #}
                        {% with event.bloodsample_set.all.0 as sample %}
                            <td>{{ sample.barcode|default:"Not recorded" }}</td>
                            <td class="{{ sample.collected|yesno:"bg-success,bg-danger,bg-warning" }}">
                                {{ sample.collected|yesno|capfirst }}
                            </td>
                            <td>{{ sample.person.trial_id }}</td>
                        {% endwith %}


                        {% elif event.type == 2 %}{# Urine #}
                        {% with event.urinesample_set.all.0 as sample %}
                            <td>{{ sample.barcode|default:"Not recorded" }}</td>
                            <td class="{{ sample.collected|yesno:"bg-success,bg-danger,bg-warning" }}">
                                {{ sample.collected|yesno|capfirst }}
                            </td>
                            <td>{{ sample.person.trial_id }}</td>
                        {% endwith %}


                        {% elif event.type == 3 %}{# Perfusate #}
                        {% with event.perfusatesample_set.all.0 as sample %}
                            <td>{{ sample.barcode|default:"Not recorded" }}</td>
                            <td class="{{ sample.collected|yesno:"bg-success,bg-danger,bg-warning" }}">
                                {{ sample.collected|yesno|capfirst }}
                            </td>
                            <td>{{ sample.organ.trial_id }}</td>
                        {% endwith %}


                        {% elif event.type == 4 %}{# Tissue #}
                        {% with event.tissuesample_set.all.0 as sample %}
                            <td>{{ sample.barcode|default:"Not recorded" }}</td>
                            <td class="{{ sample.collected|yesno:"bg-success,bg-danger,bg-warning" }}">
                                {{ sample.collected|yesno|capfirst }}
                            </td>
                            <td>{{ sample.organ.trial_id }}</td>
                        {% endwith %}
                    {% endif %}
                </tr>
            {% endfor %}
            </tbody>
        </table>

        {% include 'includes/paginator.html' %}

    {% else %}
        <p>No events are available.</p>
    {% endif %}
{% endblock %}
